#lang racket/base

(require "../../../../../parser/HumdrumSyntax.rkt"
         "../../../../../parser/file-fn.rkt"
         "../../../../../parser/spine-parsing-fn.rkt"
         "../../../../../parser/humdrum-graph/HumdrumGraph.rkt"
         "../../../../../parser/humdrum-graph/hfile-to-hgraph-fn.rkt"
         "../../../../../parser/humdrum-graph/hgraph-to-hfile-fn.rkt"
         "../../../../../parser/linked-spine/LinkedSpine.rkt"
         "../../../../../parser/linked-spine/gspines-to-linked-spines-fn.rkt"
         test-engine/racket-tests)

;; Node definitions
(define TERM-29-0 (terminator-node (token "*-" 'SpineTerminator 29 0)))
(define M-28-0 (token-node (token "==" 'Measure 28 0) (box-immutable TERM-29-0)))
(define J-27-0 (token-node (token "*v" 'SpineJoin 27 0) (box-immutable M-28-0)))
(define J-27-1 (token-node (token "*v" 'SpineJoin 27 1) (box-immutable M-28-0)))
(define NULL-26-0 (token-node (token "*" 'NullInterpretation 26 0) (box-immutable J-27-0)))
(define J-26-1 (token-node (token "*v" 'SpineJoin 26 1) (box-immutable J-27-1)))
(define J-26-2 (token-node (token "*v" 'SpineJoin 26 2) (box-immutable J-27-1)))
(define NULL-25-0 (token-node (token "*" 'NullInterpretation 25 0) (box-immutable NULL-26-0)))
(define NULL-25-1 (token-node (token "*" 'NullInterpretation 25 1) (box-immutable J-26-1)))
(define J-25-2 (token-node (token "*v" 'SpineJoin 25 2) (box-immutable J-26-2)))
(define J-25-3 (token-node (token "*v" 'SpineJoin 25 3) (box-immutable J-26-2)))
(define NULL-24-0 (token-node (token "*" 'NullInterpretation 24 0) (box-immutable NULL-25-0)))
(define NULL-24-1 (token-node (token "*" 'NullInterpretation 24 1) (box-immutable NULL-25-1)))
(define NULL-24-2 (token-node (token "*" 'NullInterpretation 24 2) (box-immutable J-25-2)))
(define NULL-24-3 (token-node (token "*" 'NullInterpretation 24 3) (box-immutable J-25-3)))
(define NULL-23-0 (token-node (token "*" 'NullInterpretation 23 0) (box-immutable NULL-24-0)))
(define NULL-23-1 (token-node (token "*" 'NullInterpretation 23 1) (box-immutable NULL-24-1)))
(define NULL-23-2 (token-node (token "*" 'NullInterpretation 23 2) (box-immutable NULL-24-2)))
(define NULL-23-3 (token-node (token "*" 'NullInterpretation 23 3) (box-immutable NULL-24-3)))
(define NULL-22-0 (token-node (token "*" 'NullInterpretation 22 0) (box-immutable NULL-23-0)))
(define NULL-22-1 (token-node (token "*" 'NullInterpretation 22 1) (box-immutable NULL-23-1)))
(define NULL-22-2 (token-node (token "*" 'NullInterpretation 22 2) (box-immutable NULL-23-2)))
(define NULL-22-3 (token-node (token "*" 'NullInterpretation 22 3) (box-immutable NULL-23-3)))
(define 4c-21-0 (token-node (token "4c" 'SpineData 21 0) (box-immutable NULL-22-0)))
(define 4c-21-1 (token-node (token "4c" 'SpineData 21 1) (box-immutable NULL-22-1)))
(define 4c-21-2 (token-node (token "4c" 'SpineData 21 2) (box-immutable NULL-22-2)))
(define 4c-21-3 (token-node (token "4c" 'SpineData 21 3) (box-immutable NULL-22-3)))
(define 4c-20-0 (token-node (token "4c" 'SpineData 20 0) (box-immutable 4c-21-0)))
(define 4c-20-1 (token-node (token "4c" 'SpineData 20 1) (box-immutable 4c-21-1)))
(define 4c-20-2 (token-node (token "4c" 'SpineData 20 2) (box-immutable 4c-21-2)))
(define 4c-20-3 (token-node (token "4c" 'SpineData 20 3) (box-immutable 4c-21-3)))
(define 4c-19-0 (token-node (token "4c" 'SpineData 19 0) (box-immutable 4c-20-0)))
(define 4c-19-1 (token-node (token "4c" 'SpineData 19 1) (box-immutable 4c-20-1)))
(define 4c-19-2 (token-node (token "4c" 'SpineData 19 2) (box-immutable 4c-20-2)))
(define 4c-19-3 (token-node (token "4c" 'SpineData 19 3) (box-immutable 4c-20-3)))
(define M-18-0 (token-node (token "=3" 'Measure 18 0) (box-immutable 4c-19-0)))
(define M-18-1 (token-node (token "=3" 'Measure 18 1) (box-immutable 4c-19-1)))
(define M-18-2 (token-node (token "=3" 'Measure 18 2) (box-immutable 4c-19-2)))
(define M-18-3 (token-node (token "=3" 'Measure 18 3) (box-immutable 4c-19-3)))
(define 4c-17-0 (token-node (token "4c" 'SpineData 17 0) (box-immutable M-18-0)))
(define 4c-17-1 (token-node (token "4c" 'SpineData 17 1) (box-immutable M-18-1)))
(define 4c-17-2 (token-node (token "4c" 'SpineData 17 2) (box-immutable M-18-2)))
(define 4c-17-3 (token-node (token "4c" 'SpineData 17 3) (box-immutable M-18-3)))
(define 4c-16-0 (token-node (token "4c" 'SpineData 16 0) (box-immutable 4c-17-0)))
(define 4c-16-1 (token-node (token "4c" 'SpineData 16 1) (box-immutable 4c-17-1)))
(define 4c-16-2 (token-node (token "4c" 'SpineData 16 2) (box-immutable 4c-17-2)))
(define 4c-16-3 (token-node (token "4c" 'SpineData 16 3) (box-immutable 4c-17-3)))
(define 4c-15-0 (token-node (token "4c" 'SpineData 15 0) (box-immutable 4c-16-0)))
(define 4c-15-1 (token-node (token "4c" 'SpineData 15 1) (box-immutable 4c-16-1)))
(define 4c-15-2 (token-node (token "4c" 'SpineData 15 2) (box-immutable 4c-16-2)))
(define 4c-15-3 (token-node (token "4c" 'SpineData 15 3) (box-immutable 4c-16-3)))
(define M-14-0 (token-node (token "=2" 'Measure 14 0) (box-immutable 4c-15-0)))
(define M-14-1 (token-node (token "=2" 'Measure 14 1) (box-immutable 4c-15-1)))
(define M-14-2 (token-node (token "=2" 'Measure 14 2) (box-immutable 4c-15-2)))
(define M-14-3 (token-node (token "=2" 'Measure 14 3) (box-immutable 4c-15-3)))
(define 4c-13-0 (token-node (token "4c" 'SpineData 13 0) (box-immutable M-14-0)))
(define 4c-13-1 (token-node (token "4c" 'SpineData 13 1) (box-immutable M-14-1)))
(define 4c-13-2 (token-node (token "4c" 'SpineData 13 2) (box-immutable M-14-2)))
(define 4c-13-3 (token-node (token "4c" 'SpineData 13 3) (box-immutable M-14-3)))
(define 4c-12-0 (token-node (token "4c" 'SpineData 12 0) (box-immutable 4c-13-0)))
(define 4c-12-1 (token-node (token "4c" 'SpineData 12 1) (box-immutable 4c-13-1)))
(define 4c-12-2 (token-node (token "4c" 'SpineData 12 2) (box-immutable 4c-13-2)))
(define 4c-12-3 (token-node (token "4c" 'SpineData 12 3) (box-immutable 4c-13-3)))
(define 4c-11-0 (token-node (token "4c" 'SpineData 11 0) (box-immutable 4c-12-0)))
(define 4c-11-1 (token-node (token "4c" 'SpineData 11 1) (box-immutable 4c-12-1)))
(define 4c-11-2 (token-node (token "4c" 'SpineData 11 2) (box-immutable 4c-12-2)))
(define 4c-11-3 (token-node (token "4c" 'SpineData 11 3) (box-immutable 4c-12-3)))
(define NULL-10-0 (token-node (token "*" 'NullInterpretation 10 0) (box-immutable 4c-11-0)))
(define NULL-10-1 (token-node (token "*" 'NullInterpretation 10 1) (box-immutable 4c-11-1)))
(define NULL-10-2 (token-node (token "*" 'NullInterpretation 10 2) (box-immutable 4c-11-2)))
(define NULL-10-3 (token-node (token "*" 'NullInterpretation 10 3) (box-immutable 4c-11-3)))
(define NULL-9-0 (token-node (token "*" 'NullInterpretation 9 0) (box-immutable NULL-10-0)))
(define NULL-9-1 (token-node (token "*" 'NullInterpretation 9 1) (box-immutable NULL-10-1)))
(define S-9-2 (split-node (token "*^" 'SpineSplit 9 2)
                          (box-immutable NULL-10-2)
                          (box-immutable NULL-10-3)))
(define NULL-8-0 (token-node (token "*" 'NullInterpretation 8 0) (box-immutable NULL-9-0)))
(define NULL-8-1 (token-node (token "*" 'NullInterpretation 8 1) (box-immutable NULL-9-1)))
(define NULL-8-2 (token-node (token "*" 'NullInterpretation 8 2) (box-immutable S-9-2)))
(define NULL-7-0 (token-node (token "*" 'NullInterpretation 7 0) (box-immutable NULL-8-0)))
(define S-7-1 (split-node (token "*^" 'SpineSplit 7 1)
                          (box-immutable NULL-8-1)
                          (box-immutable NULL-8-2)))
(define NULL-6-0 (token-node (token "*" 'NullInterpretation 6 0) (box-immutable NULL-7-0)))
(define NULL-6-1 (token-node (token "*" 'NullInterpretation 6 1) (box-immutable S-7-1)))
(define S-5-0 (split-node (token "*^" 'SpineSplit 5 0)
                          (box-immutable NULL-6-0)
                          (box-immutable NULL-6-1)))
(define TS-4-0 (token-node (token "*M3/4" 'TimeSignature 4 0) (box-immutable S-5-0)))
(define KL-3-0 (token-node (token "*a:" 'KeyLabel 3 0) (box-immutable TS-4-0)))
(define KS-2-0 (token-node (token "*k[]" 'KeySignature 2 0) (box-immutable KL-3-0)))
(define CL-1-0 (token-node (token "*clefG2" 'Clef 1 0) (box-immutable KS-2-0)))
(define KERN-0-0 (token-node (token "**kern" 'ExclusiveInterpretation 0 0) (box-immutable CL-1-0)))

(define TERM-29-1 (terminator-node (token "*-" 'SpineTerminator 29 1)))
(define M-28-1 (token-node (token "==" 'Measure 28 1) (box-immutable TERM-29-1)))
(define NULL-27-2 (token-node (token "*" 'NullInterpretation 27 2) (box-immutable M-28-1)))
(define NULL-26-3 (token-node (token "*" 'NullInterpretation 26 3) (box-immutable NULL-27-2)))
(define NULL-25-4 (token-node (token "*" 'NullInterpretation 25 4) (box-immutable NULL-26-3)))
(define J-24-4 (token-node (token "*v" 'SpineJoin 24 4) (box-immutable NULL-25-4)))
(define J-24-5 (token-node (token "*v" 'SpineJoin 24 5) (box-immutable NULL-25-4)))
(define NULL-23-4 (token-node (token "*" 'NullInterpretation 23 4) (box-immutable J-24-4)))
(define J-23-5 (token-node (token "*v" 'SpineJoin 23 5) (box-immutable J-24-5)))
(define J-23-6 (token-node (token "*v" 'SpineJoin 23 6) (box-immutable J-24-5)))
(define NULL-22-4 (token-node (token "*" 'NullInterpretation 22 4) (box-immutable NULL-23-4)))
(define NULL-22-5 (token-node (token "*" 'NullInterpretation 22 5) (box-immutable J-23-5)))
(define J-22-6 (token-node (token "*v" 'SpineJoin 22 6) (box-immutable J-23-6)))
(define J-22-7 (token-node (token "*v" 'SpineJoin 22 7) (box-immutable J-23-6)))
(define 4c-21-4 (token-node (token "4c" 'SpineData 21 4) (box-immutable NULL-22-4)))
(define 4c-21-5 (token-node (token "4c" 'SpineData 21 5) (box-immutable NULL-22-5)))
(define 4c-21-6 (token-node (token "4c" 'SpineData 21 6) (box-immutable J-22-6)))
(define 4c-21-7 (token-node (token "4c" 'SpineData 21 7) (box-immutable J-22-7)))
(define 4c-20-4 (token-node (token "4c" 'SpineData 20 4) (box-immutable 4c-21-4)))
(define 4c-20-5 (token-node (token "4c" 'SpineData 20 5) (box-immutable 4c-21-5)))
(define 4c-20-6 (token-node (token "4c" 'SpineData 20 6) (box-immutable 4c-21-6)))
(define 4c-20-7 (token-node (token "4c" 'SpineData 20 7) (box-immutable 4c-21-7)))
(define 4c-19-4 (token-node (token "4c" 'SpineData 19 4) (box-immutable 4c-20-4)))
(define 4c-19-5 (token-node (token "4c" 'SpineData 19 5) (box-immutable 4c-20-5)))
(define 4c-19-6 (token-node (token "4c" 'SpineData 19 6) (box-immutable 4c-20-6)))
(define 4c-19-7 (token-node (token "4c" 'SpineData 19 7) (box-immutable 4c-20-7)))
(define M-18-4 (token-node (token "=3" 'Measure 18 4) (box-immutable 4c-19-4)))
(define M-18-5 (token-node (token "=3" 'Measure 18 5) (box-immutable 4c-19-5)))
(define M-18-6 (token-node (token "=3" 'Measure 18 6) (box-immutable 4c-19-6)))
(define M-18-7 (token-node (token "=3" 'Measure 18 7) (box-immutable 4c-19-7)))
(define 4c-17-4 (token-node (token "4c" 'SpineData 17 4) (box-immutable M-18-4)))
(define 4c-17-5 (token-node (token "4c" 'SpineData 17 5) (box-immutable M-18-5)))
(define 4c-17-6 (token-node (token "4c" 'SpineData 17 6) (box-immutable M-18-6)))
(define 4c-17-7 (token-node (token "4c" 'SpineData 17 7) (box-immutable M-18-7)))
(define 4c-16-4 (token-node (token "4c" 'SpineData 16 4) (box-immutable 4c-17-4)))
(define 4c-16-5 (token-node (token "4c" 'SpineData 16 5) (box-immutable 4c-17-5)))
(define 4c-16-6 (token-node (token "4c" 'SpineData 16 6) (box-immutable 4c-17-6)))
(define 4c-16-7 (token-node (token "4c" 'SpineData 16 7) (box-immutable 4c-17-7)))
(define 4c-15-4 (token-node (token "4c" 'SpineData 15 4) (box-immutable 4c-16-4)))
(define 4c-15-5 (token-node (token "4c" 'SpineData 15 5) (box-immutable 4c-16-5)))
(define 4c-15-6 (token-node (token "4c" 'SpineData 15 6) (box-immutable 4c-16-6)))
(define 4c-15-7 (token-node (token "4c" 'SpineData 15 7) (box-immutable 4c-16-7)))
(define M-14-4 (token-node (token "=2" 'Measure 14 4) (box-immutable 4c-15-4)))
(define M-14-5 (token-node (token "=2" 'Measure 14 5) (box-immutable 4c-15-5)))
(define M-14-6 (token-node (token "=2" 'Measure 14 6) (box-immutable 4c-15-6)))
(define M-14-7 (token-node (token "=2" 'Measure 14 7) (box-immutable 4c-15-7)))
(define 4c-13-4 (token-node (token "4c" 'SpineData 13 4) (box-immutable M-14-4)))
(define 4c-13-5 (token-node (token "4c" 'SpineData 13 5) (box-immutable M-14-5)))
(define 4c-13-6 (token-node (token "4c" 'SpineData 13 6) (box-immutable M-14-6)))
(define 4c-13-7 (token-node (token "4c" 'SpineData 13 7) (box-immutable M-14-7)))
(define 4c-12-4 (token-node (token "4c" 'SpineData 12 4) (box-immutable 4c-13-4)))
(define 4c-12-5 (token-node (token "4c" 'SpineData 12 5) (box-immutable 4c-13-5)))
(define 4c-12-6 (token-node (token "4c" 'SpineData 12 6) (box-immutable 4c-13-6)))
(define 4c-12-7 (token-node (token "4c" 'SpineData 12 7) (box-immutable 4c-13-7)))
(define 4c-11-4 (token-node (token "4c" 'SpineData 11 4) (box-immutable 4c-12-4)))
(define 4c-11-5 (token-node (token "4c" 'SpineData 11 5) (box-immutable 4c-12-5)))
(define 4c-11-6 (token-node (token "4c" 'SpineData 11 6) (box-immutable 4c-12-6)))
(define 4c-11-7 (token-node (token "4c" 'SpineData 11 7) (box-immutable 4c-12-7)))
(define NULL-10-4 (token-node (token "*" 'NullInterpretation 10 4) (box-immutable 4c-11-4)))
(define NULL-10-5 (token-node (token "*" 'NullInterpretation 10 5) (box-immutable 4c-11-5)))
(define S-10-6 (split-node (token "*^" 'SpineSplit 10 6)
                           (box-immutable 4c-11-6)
                           (box-immutable 4c-11-7)))
(define NULL-9-3 (token-node (token "*" 'NullInterpretation 9 3) (box-immutable NULL-10-4)))
(define NULL-9-4 (token-node (token "*" 'NullInterpretation 9 4) (box-immutable NULL-10-5)))
(define NULL-9-5 (token-node (token "*" 'NullInterpretation 9 5) (box-immutable S-10-6)))
(define NULL-8-3 (token-node (token "*" 'NullInterpretation 8 3) (box-immutable NULL-9-3)))
(define S-8-4 (split-node (token "*^" 'SpineSplit 8 4)
                          (box-immutable NULL-9-4)
                          (box-immutable NULL-9-5)))
(define NULL-7-2 (token-node (token "*" 'NullInterpretation 7 2) (box-immutable NULL-8-3)))
(define NULL-7-3 (token-node (token "*" 'NullInterpretation 7 3) (box-immutable S-8-4)))
(define S-6-2 (split-node (token "*^" 'SpineSplit 6 2)
                          (box-immutable NULL-7-2)
                          (box-immutable NULL-7-3)))
(define NULL-5-1 (token-node (token "*" 'NullInterpretation 5 1) (box-immutable S-6-2)))
(define TS-4-1 (token-node (token "*M3/4" 'TimeSignature 4 1) (box-immutable NULL-5-1)))
(define KL-3-1 (token-node (token "*a:" 'KeyLabel 3 1) (box-immutable TS-4-1)))
(define KS-2-1 (token-node (token "*k[]" 'KeySignature 2 1) (box-immutable KL-3-1)))
(define CL-1-1 (token-node (token "*clefG2" 'Clef 1 1) (box-immutable KS-2-1)))
(define KERN-0-1 (token-node (token "**kern" 'ExclusiveInterpretation 0 1) (box-immutable CL-1-1)))

(check-expect (path->hfile "../../data/count/two-spines-three-splits.krn")
              (hfile (list (record "**kern\t**kern" 'ExclusiveInterpretation
                                   (list (token "**kern" 'ExclusiveInterpretation 0 0)
                                         (token "**kern" 'ExclusiveInterpretation 0 1))
                                   0)
                           (record "*clefG2\t*clefG2" 'TandemInterpretation
                                   (list (token "*clefG2" 'Clef 1 0)
                                         (token "*clefG2" 'Clef 1 1))
                                   1)
                           (record "*k[]\t*k[]" 'TandemInterpretation
                                   (list (token "*k[]" 'KeySignature 2 0)
                                         (token "*k[]" 'KeySignature 2 1))
                                   2)
                           (record "*a:\t*a:" 'TandemInterpretation
                                   (list (token "*a:" 'KeyLabel 3 0)
                                         (token "*a:" 'KeyLabel 3 1))
                                   3)
                           (record "*M3/4\t*M3/4" 'TandemInterpretation
                                   (list (token "*M3/4" 'TimeSignature 4 0)
                                         (token "*M3/4" 'TimeSignature 4 1))
                                   4)
                           (record "*^\t*" 'TandemInterpretation
                                   (list (token "*^" 'SpineSplit 5 0)
                                         (token "*" 'NullInterpretation 5 1))
                                   5)
                           (record "*\t*\t*^" 'TandemInterpretation
                                   (list (token "*" 'NullInterpretation 6 0)
                                         (token "*" 'NullInterpretation 6 1)
                                         (token "*^" 'SpineSplit 6 2))
                                   6)
                           (record "*\t*^\t*\t*" 'TandemInterpretation
                                   (list (token "*" 'NullInterpretation 7 0)
                                         (token "*^" 'SpineSplit 7 1)
                                         (token "*" 'NullInterpretation 7 2)
                                         (token "*" 'NullInterpretation 7 3))
                                   7)
                           (record "*\t*\t*\t*\t*^" 'TandemInterpretation
                                   (list (token "*" 'NullInterpretation 8 0)
                                         (token "*" 'NullInterpretation 8 1)
                                         (token "*" 'NullInterpretation 8 2)
                                         (token "*" 'NullInterpretation 8 3)
                                         (token "*^" 'SpineSplit 8 4))
                                   8)
                           (record "*\t*\t*^\t*\t*\t*" 'TandemInterpretation
                                   (list (token "*" 'NullInterpretation 9 0)
                                         (token "*" 'NullInterpretation 9 1)
                                         (token "*^" 'SpineSplit 9 2)
                                         (token "*" 'NullInterpretation 9 3)
                                         (token "*" 'NullInterpretation 9 4)
                                         (token "*" 'NullInterpretation 9 5))
                                   9)
                           (record "*\t*\t*\t*\t*\t*\t*^" 'TandemInterpretation
                                   (list (token "*" 'NullInterpretation 10 0)
                                         (token "*" 'NullInterpretation 10 1)
                                         (token "*" 'NullInterpretation 10 2)
                                         (token "*" 'NullInterpretation 10 3)
                                         (token "*" 'NullInterpretation 10 4)
                                         (token "*" 'NullInterpretation 10 5)
                                         (token "*^" 'SpineSplit 10 6))
                                   10)
                           (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                                   (list (token "4c" 'SpineData 11 0)
                                         (token "4c" 'SpineData 11 1)
                                         (token "4c" 'SpineData 11 2)
                                         (token "4c" 'SpineData 11 3)
                                         (token "4c" 'SpineData 11 4)
                                         (token "4c" 'SpineData 11 5)
                                         (token "4c" 'SpineData 11 6)
                                         (token "4c" 'SpineData 11 7))
                                   11)
                           (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                                   (list (token "4c" 'SpineData 12 0)
                                         (token "4c" 'SpineData 12 1)
                                         (token "4c" 'SpineData 12 2)
                                         (token "4c" 'SpineData 12 3)
                                         (token "4c" 'SpineData 12 4)
                                         (token "4c" 'SpineData 12 5)
                                         (token "4c" 'SpineData 12 6)
                                         (token "4c" 'SpineData 12 7))
                                   12)
                           (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                                   (list (token "4c" 'SpineData 13 0)
                                         (token "4c" 'SpineData 13 1)
                                         (token "4c" 'SpineData 13 2)
                                         (token "4c" 'SpineData 13 3)
                                         (token "4c" 'SpineData 13 4)
                                         (token "4c" 'SpineData 13 5)
                                         (token "4c" 'SpineData 13 6)
                                         (token "4c" 'SpineData 13 7))
                                   13)
                           (record "=2\t=2\t=2\t=2\t=2\t=2\t=2\t=2" 'Measure
                                   (list (token "=2" 'Measure 14 0)
                                         (token "=2" 'Measure 14 1)
                                         (token "=2" 'Measure 14 2)
                                         (token "=2" 'Measure 14 3)
                                         (token "=2" 'Measure 14 4)
                                         (token "=2" 'Measure 14 5)
                                         (token "=2" 'Measure 14 6)
                                         (token "=2" 'Measure 14 7))
                                   14)
                           (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                                   (list (token "4c" 'SpineData 15 0)
                                         (token "4c" 'SpineData 15 1)
                                         (token "4c" 'SpineData 15 2)
                                         (token "4c" 'SpineData 15 3)
                                         (token "4c" 'SpineData 15 4)
                                         (token "4c" 'SpineData 15 5)
                                         (token "4c" 'SpineData 15 6)
                                         (token "4c" 'SpineData 15 7))
                                   15)
                           (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                                   (list (token "4c" 'SpineData 16 0)
                                         (token "4c" 'SpineData 16 1)
                                         (token "4c" 'SpineData 16 2)
                                         (token "4c" 'SpineData 16 3)
                                         (token "4c" 'SpineData 16 4)
                                         (token "4c" 'SpineData 16 5)
                                         (token "4c" 'SpineData 16 6)
                                         (token "4c" 'SpineData 16 7))
                                   16)
                           (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                                   (list (token "4c" 'SpineData 17 0)
                                         (token "4c" 'SpineData 17 1)
                                         (token "4c" 'SpineData 17 2)
                                         (token "4c" 'SpineData 17 3)
                                         (token "4c" 'SpineData 17 4)
                                         (token "4c" 'SpineData 17 5)
                                         (token "4c" 'SpineData 17 6)
                                         (token "4c" 'SpineData 17 7))
                                   17)
                           (record "=3\t=3\t=3\t=3\t=3\t=3\t=3\t=3" 'Measure
                                   (list (token "=3" 'Measure 18 0)
                                         (token "=3" 'Measure 18 1)
                                         (token "=3" 'Measure 18 2)
                                         (token "=3" 'Measure 18 3)
                                         (token "=3" 'Measure 18 4)
                                         (token "=3" 'Measure 18 5)
                                         (token "=3" 'Measure 18 6)
                                         (token "=3" 'Measure 18 7))
                                   18)
                           (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                                   (list (token "4c" 'SpineData 19 0)
                                         (token "4c" 'SpineData 19 1)
                                         (token "4c" 'SpineData 19 2)
                                         (token "4c" 'SpineData 19 3)
                                         (token "4c" 'SpineData 19 4)
                                         (token "4c" 'SpineData 19 5)
                                         (token "4c" 'SpineData 19 6)
                                         (token "4c" 'SpineData 19 7))
                                   19)
                           (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                                   (list (token "4c" 'SpineData 20 0)
                                         (token "4c" 'SpineData 20 1)
                                         (token "4c" 'SpineData 20 2)
                                         (token "4c" 'SpineData 20 3)
                                         (token "4c" 'SpineData 20 4)
                                         (token "4c" 'SpineData 20 5)
                                         (token "4c" 'SpineData 20 6)
                                         (token "4c" 'SpineData 20 7))
                                   20)
                           (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                                   (list (token "4c" 'SpineData 21 0)
                                         (token "4c" 'SpineData 21 1)
                                         (token "4c" 'SpineData 21 2)
                                         (token "4c" 'SpineData 21 3)
                                         (token "4c" 'SpineData 21 4)
                                         (token "4c" 'SpineData 21 5)
                                         (token "4c" 'SpineData 21 6)
                                         (token "4c" 'SpineData 21 7))
                                   21)
                           (record "*\t*\t*\t*\t*\t*\t*v\t*v" 'TandemInterpretation
                                   (list (token "*" 'NullInterpretation 22 0)
                                         (token "*" 'NullInterpretation 22 1)
                                         (token "*" 'NullInterpretation 22 2)
                                         (token "*" 'NullInterpretation 22 3)
                                         (token "*" 'NullInterpretation 22 4)
                                         (token "*" 'NullInterpretation 22 5)
                                         (token "*v" 'SpineJoin 22 6)
                                         (token "*v" 'SpineJoin 22 7))
                                   22)
                           (record "*\t*\t*\t*\t*\t*v\t*v" 'TandemInterpretation
                                   (list (token "*" 'NullInterpretation 23 0)
                                         (token "*" 'NullInterpretation 23 1)
                                         (token "*" 'NullInterpretation 23 2)
                                         (token "*" 'NullInterpretation 23 3)
                                         (token "*" 'NullInterpretation 23 4)
                                         (token "*v" 'SpineJoin 23 5)
                                         (token "*v" 'SpineJoin 23 6))
                                   23)
                           (record "*\t*\t*\t*\t*v\t*v" 'TandemInterpretation
                                   (list (token "*" 'NullInterpretation 24 0)
                                         (token "*" 'NullInterpretation 24 1)
                                         (token "*" 'NullInterpretation 24 2)
                                         (token "*" 'NullInterpretation 24 3)
                                         (token "*v" 'SpineJoin 24 4)
                                         (token "*v" 'SpineJoin 24 5))
                                   24)
                           (record "*\t*\t*v\t*v\t*" 'TandemInterpretation
                                   (list (token "*" 'NullInterpretation 25 0)
                                         (token "*" 'NullInterpretation 25 1)
                                         (token "*v" 'SpineJoin 25 2)
                                         (token "*v" 'SpineJoin 25 3)
                                         (token "*" 'NullInterpretation 25 4))
                                   25)
                           (record "*\t*v\t*v\t*" 'TandemInterpretation
                                   (list (token "*" 'NullInterpretation 26 0)
                                         (token "*v" 'SpineJoin 26 1)
                                         (token "*v" 'SpineJoin 26 2)
                                         (token "*" 'NullInterpretation 26 3))
                                   26)
                           (record "*v\t*v\t*" 'TandemInterpretation (list (token "*v" 'SpineJoin 27 0)
                                                           (token "*v" 'SpineJoin 27 1)
                                                           (token "*" 'NullInterpretation 27 2))
                                   27)
                           (record "==\t==" 'Measure (list (token "==" 'Measure 28 0)
                                                        (token "==" 'Measure 28 1))
                                   28)
                           (record "*-\t*-" 'TandemInterpretation (list (token "*-" 'SpineTerminator 29 0)
                                                        (token "*-" 'SpineTerminator 29 1))
                                   29))))
(check-expect (spine-parser (path->hfile "../../data/count/two-spines-three-splits.krn"))
              (list (global-spine 'Kern
                                  (list (list (token "**kern" 'ExclusiveInterpretation 0 0))
                                        (list (token "*clefG2" 'Clef 1 0))
                                        (list (token "*k[]" 'KeySignature 2 0))
                                        (list (token "*a:" 'KeyLabel 3 0))
                                        (list (token "*M3/4" 'TimeSignature 4 0))
                                        (list (token "*^" 'SpineSplit 5 0))
                                        (list (token "*" 'NullInterpretation 6 0)
                                              (token "*" 'NullInterpretation 6 1))
                                        (list (token "*" 'NullInterpretation 7 0)
                                              (token "*^" 'SpineSplit 7 1))
                                        (list (token "*" 'NullInterpretation 8 0)
                                              (token "*" 'NullInterpretation 8 1)
                                              (token "*" 'NullInterpretation 8 2))
                                        (list (token "*" 'NullInterpretation 9 0)
                                              (token "*" 'NullInterpretation 9 1)
                                              (token "*^" 'SpineSplit 9 2))
                                        (list (token "*" 'NullInterpretation 10 0)
                                              (token "*" 'NullInterpretation 10 1)
                                              (token "*" 'NullInterpretation 10 2)
                                              (token "*" 'NullInterpretation 10 3))
                                        (list (token "4c" 'SpineData 11 0)
                                              (token "4c" 'SpineData 11 1)
                                              (token "4c" 'SpineData 11 2)
                                              (token "4c" 'SpineData 11 3))
                                        (list (token "4c" 'SpineData 12 0)
                                              (token "4c" 'SpineData 12 1)
                                              (token "4c" 'SpineData 12 2)
                                              (token "4c" 'SpineData 12 3))
                                        (list (token "4c" 'SpineData 13 0)
                                              (token "4c" 'SpineData 13 1)
                                              (token "4c" 'SpineData 13 2)
                                              (token "4c" 'SpineData 13 3))
                                        (list (token "=2" 'Measure 14 0)
                                              (token "=2" 'Measure 14 1)
                                              (token "=2" 'Measure 14 2)
                                              (token "=2" 'Measure 14 3))
                                        (list (token "4c" 'SpineData 15 0)
                                              (token "4c" 'SpineData 15 1)
                                              (token "4c" 'SpineData 15 2)
                                              (token "4c" 'SpineData 15 3))
                                        (list (token "4c" 'SpineData 16 0)
                                              (token "4c" 'SpineData 16 1)
                                              (token "4c" 'SpineData 16 2)
                                              (token "4c" 'SpineData 16 3))
                                        (list (token "4c" 'SpineData 17 0)
                                              (token "4c" 'SpineData 17 1)
                                              (token "4c" 'SpineData 17 2)
                                              (token "4c" 'SpineData 17 3))
                                        (list (token "=3" 'Measure 18 0)
                                              (token "=3" 'Measure 18 1)
                                              (token "=3" 'Measure 18 2)
                                              (token "=3" 'Measure 18 3))
                                        (list (token "4c" 'SpineData 19 0)
                                              (token "4c" 'SpineData 19 1)
                                              (token "4c" 'SpineData 19 2)
                                              (token "4c" 'SpineData 19 3))
                                        (list (token "4c" 'SpineData 20 0)
                                              (token "4c" 'SpineData 20 1)
                                              (token "4c" 'SpineData 20 2)
                                              (token "4c" 'SpineData 20 3))
                                        (list (token "4c" 'SpineData 21 0)
                                              (token "4c" 'SpineData 21 1)
                                              (token "4c" 'SpineData 21 2)
                                              (token "4c" 'SpineData 21 3))
                                        (list (token "*" 'NullInterpretation 22 0)
                                              (token "*" 'NullInterpretation 22 1)
                                              (token "*" 'NullInterpretation 22 2)
                                              (token "*" 'NullInterpretation 22 3))
                                        (list (token "*" 'NullInterpretation 23 0)
                                              (token "*" 'NullInterpretation 23 1)
                                              (token "*" 'NullInterpretation 23 2)
                                              (token "*" 'NullInterpretation 23 3))
                                        (list (token "*" 'NullInterpretation 24 0)
                                              (token "*" 'NullInterpretation 24 1)
                                              (token "*" 'NullInterpretation 24 2)
                                              (token "*" 'NullInterpretation 24 3))
                                        (list (token "*" 'NullInterpretation 25 0)
                                              (token "*" 'NullInterpretation 25 1)
                                              (token "*v" 'SpineJoin 25 2)
                                              (token "*v" 'SpineJoin 25 3))
                                        (list (token "*" 'NullInterpretation 26 0)
                                              (token "*v" 'SpineJoin 26 1)
                                              (token "*v" 'SpineJoin 26 2))
                                        (list (token "*v" 'SpineJoin 27 0)
                                              (token "*v" 'SpineJoin 27 1))
                                        (list (token "==" 'Measure 28 0))
                                        (list (token "*-" 'SpineTerminator 29 0)))
                                  0)
                    (global-spine 'Kern
                                  (list (list (token "**kern" 'ExclusiveInterpretation 0 1))
                                        (list (token "*clefG2" 'Clef 1 1))
                                        (list (token "*k[]" 'KeySignature 2 1))
                                        (list (token "*a:" 'KeyLabel 3 1))
                                        (list (token "*M3/4" 'TimeSignature 4 1))
                                        (list (token "*" 'NullInterpretation 5 1))
                                        (list (token "*^" 'SpineSplit 6 2))
                                        (list (token "*" 'NullInterpretation 7 2)
                                              (token "*" 'NullInterpretation 7 3))
                                        (list (token "*" 'NullInterpretation 8 3)
                                              (token "*^" 'SpineSplit 8 4))
                                        (list (token "*" 'NullInterpretation 9 3)
                                              (token "*" 'NullInterpretation 9 4)
                                              (token "*" 'NullInterpretation 9 5))
                                        (list (token "*" 'NullInterpretation 10 4)
                                              (token "*" 'NullInterpretation 10 5)
                                              (token "*^" 'SpineSplit 10 6))
                                        (list (token "4c" 'SpineData 11 4)
                                              (token "4c" 'SpineData 11 5)
                                              (token "4c" 'SpineData 11 6)
                                              (token "4c" 'SpineData 11 7))
                                        (list (token "4c" 'SpineData 12 4)
                                              (token "4c" 'SpineData 12 5)
                                              (token "4c" 'SpineData 12 6)
                                              (token "4c" 'SpineData 12 7))
                                        (list (token "4c" 'SpineData 13 4)
                                              (token "4c" 'SpineData 13 5)
                                              (token "4c" 'SpineData 13 6)
                                              (token "4c" 'SpineData 13 7))
                                        (list (token "=2" 'Measure 14 4)
                                              (token "=2" 'Measure 14 5)
                                              (token "=2" 'Measure 14 6)
                                              (token "=2" 'Measure 14 7))
                                        (list (token "4c" 'SpineData 15 4)
                                              (token "4c" 'SpineData 15 5)
                                              (token "4c" 'SpineData 15 6)
                                              (token "4c" 'SpineData 15 7))
                                        (list (token "4c" 'SpineData 16 4)
                                              (token "4c" 'SpineData 16 5)
                                              (token "4c" 'SpineData 16 6)
                                              (token "4c" 'SpineData 16 7))
                                        (list (token "4c" 'SpineData 17 4)
                                              (token "4c" 'SpineData 17 5)
                                              (token "4c" 'SpineData 17 6)
                                              (token "4c" 'SpineData 17 7))
                                        (list (token "=3" 'Measure 18 4)
                                              (token "=3" 'Measure 18 5)
                                              (token "=3" 'Measure 18 6)
                                              (token "=3" 'Measure 18 7))
                                        (list (token "4c" 'SpineData 19 4)
                                              (token "4c" 'SpineData 19 5)
                                              (token "4c" 'SpineData 19 6)
                                              (token "4c" 'SpineData 19 7))
                                        (list (token "4c" 'SpineData 20 4)
                                              (token "4c" 'SpineData 20 5)
                                              (token "4c" 'SpineData 20 6)
                                              (token "4c" 'SpineData 20 7))
                                        (list (token "4c" 'SpineData 21 4)
                                              (token "4c" 'SpineData 21 5)
                                              (token "4c" 'SpineData 21 6)
                                              (token "4c" 'SpineData 21 7))
                                        (list (token "*" 'NullInterpretation 22 4)
                                              (token "*" 'NullInterpretation 22 5)
                                              (token "*v" 'SpineJoin 22 6)
                                              (token "*v" 'SpineJoin 22 7))
                                        (list (token "*" 'NullInterpretation 23 4)
                                              (token "*v" 'SpineJoin 23 5)
                                              (token "*v" 'SpineJoin 23 6))
                                        (list (token "*v" 'SpineJoin 24 4)
                                              (token "*v" 'SpineJoin 24 5))
                                        (list (token "*" 'NullInterpretation 25 4))
                                        (list (token "*" 'NullInterpretation 26 3))
                                        (list (token "*" 'NullInterpretation 27 2))
                                        (list (token "==" 'Measure 28 1))
                                        (list (token "*-" 'SpineTerminator 29 1)))
                                  1)))
(check-expect (hgraph->hfile
               (hgraph (root (list (list (leaf (token "**kern" 'ExclusiveInterpretation 0 0))
                                         (leaf (token "*clefG2" 'Clef 1 0))
                                         (leaf (token "*k[]" 'KeySignature 2 0))
                                         (leaf (token "*a:" 'KeyLabel 3 0))
                                         (leaf (token "*M3/4" 'TimeSignature 4 0))
                                         (parent (token "*^" 'SpineSplit 5 0)
                                                 (list (leaf (token "*" 'NullInterpretation 6 0))
                                                       (leaf (token "*" 'NullInterpretation 7 0))
                                                       (leaf (token "*" 'NullInterpretation 8 0))
                                                       (leaf (token "*" 'NullInterpretation 9 0))
                                                       (leaf (token "*" 'NullInterpretation 10 0))
                                                       (leaf (token "4c" 'SpineData 11 0))
                                                       (leaf (token "4c" 'SpineData 12 0))
                                                       (leaf (token "4c" 'SpineData 13 0))
                                                       (leaf (token "=2" 'Measure 14 0))
                                                       (leaf (token "4c" 'SpineData 15 0))
                                                       (leaf (token "4c" 'SpineData 16 0))
                                                       (leaf (token "4c" 'SpineData 17 0))
                                                       (leaf (token "=3" 'Measure 18 0))
                                                       (leaf (token "4c" 'SpineData 19 0))
                                                       (leaf (token "4c" 'SpineData 20 0))
                                                       (leaf (token "4c" 'SpineData 21 0))
                                                       (leaf (token "*" 'NullInterpretation 22 0))
                                                       (leaf (token "*" 'NullInterpretation 23 0))
                                                       (leaf (token "*" 'NullInterpretation 24 0))
                                                       (leaf (token "*" 'NullInterpretation 25 0))
                                                       (leaf (token "*" 'NullInterpretation 26 0))
                                                       (leaf (token "*v" 'SpineJoin 27 0)))
                                                 (list (leaf (token "*" 'NullInterpretation 6 1))
                                                       (parent (token "*^" 'SpineSplit 7 1)
                                                               (list (leaf (token "*" 'NullInterpretation 8 1))
                                                                     (leaf (token "*" 'NullInterpretation 9 1))
                                                                     (leaf (token "*" 'NullInterpretation 10 1))
                                                                     (leaf (token "4c" 'SpineData 11 1))
                                                                     (leaf (token "4c" 'SpineData 12 1))
                                                                     (leaf (token "4c" 'SpineData 13 1))
                                                                     (leaf (token "=2" 'Measure 14 1))
                                                                     (leaf (token "4c" 'SpineData 15 1))
                                                                     (leaf (token "4c" 'SpineData 16 1))
                                                                     (leaf (token "4c" 'SpineData 17 1))
                                                                     (leaf (token "=3" 'Measure 18 1))
                                                                     (leaf (token "4c" 'SpineData 19 1))
                                                                     (leaf (token "4c" 'SpineData 20 1))
                                                                     (leaf (token "4c" 'SpineData 21 1))
                                                                     (leaf (token "*" 'NullInterpretation 22 1))
                                                                     (leaf (token "*" 'NullInterpretation 23 1))
                                                                     (leaf (token "*" 'NullInterpretation 24 1))
                                                                     (leaf (token "*" 'NullInterpretation 25 1))
                                                                     (leaf (token "*v" 'SpineJoin 26 1)))
                                                               (list (leaf (token "*" 'NullInterpretation 8 2))
                                                                     (parent (token "*^" 'SpineSplit 9 2)
                                                                             (list (leaf (token "*" 'NullInterpretation 10 2))
                                                                                   (leaf (token "4c" 'SpineData 11 2))
                                                                                   (leaf (token "4c" 'SpineData 12 2))
                                                                                   (leaf (token "4c" 'SpineData 13 2))
                                                                                   (leaf (token "=2" 'Measure 14 2))
                                                                                   (leaf (token "4c" 'SpineData 15 2))
                                                                                   (leaf (token "4c" 'SpineData 16 2))
                                                                                   (leaf (token "4c" 'SpineData 17 2))
                                                                                   (leaf (token "=3" 'Measure 18 2))
                                                                                   (leaf (token "4c" 'SpineData 19 2))
                                                                                   (leaf (token "4c" 'SpineData 20 2))
                                                                                   (leaf (token "4c" 'SpineData 21 2))
                                                                                   (leaf (token "*" 'NullInterpretation 22 2))
                                                                                   (leaf (token "*" 'NullInterpretation 23 2))
                                                                                   (leaf (token "*" 'NullInterpretation 24 2))
                                                                                   (leaf (token "*v" 'SpineJoin 25 2)))
                                                                             (list (leaf (token "*" 'NullInterpretation 10 3))
                                                                                   (leaf (token "4c" 'SpineData 11 3))
                                                                                   (leaf (token "4c" 'SpineData 12 3))
                                                                                   (leaf (token "4c" 'SpineData 13 3))
                                                                                   (leaf (token "=2" 'Measure 14 3))
                                                                                   (leaf (token "4c" 'SpineData 15 3))
                                                                                   (leaf (token "4c" 'SpineData 16 3))
                                                                                   (leaf (token "4c" 'SpineData 17 3))
                                                                                   (leaf (token "=3" 'Measure 18 3))
                                                                                   (leaf (token "4c" 'SpineData 19 3))
                                                                                   (leaf (token "4c" 'SpineData 20 3))
                                                                                   (leaf (token "4c" 'SpineData 21 3))
                                                                                   (leaf (token "*" 'NullInterpretation 22 3))
                                                                                   (leaf (token "*" 'NullInterpretation 23 3))
                                                                                   (leaf (token "*" 'NullInterpretation 24 3))
                                                                                   (leaf (token "*v" 'SpineJoin 25 3))))
                                                                     (leaf (token "*v" 'SpineJoin 26 2))))
                                                       (leaf (token "*v" 'SpineJoin 27 1))))
                                         (leaf (token "==" 'Measure 28 0))
                                         (leaf (token "*-" 'SpineTerminator 29 0)))
                                   (list (leaf (token "**kern" 'ExclusiveInterpretation 0 1))
                                         (leaf (token "*clefG2" 'Clef 1 1))
                                         (leaf (token "*k[]" 'KeySignature 2 1))
                                         (leaf (token "*a:" 'KeyLabel 3 1))
                                         (leaf (token "*M3/4" 'TimeSignature 4 1))
                                         (leaf (token "*" 'NullInterpretation 5 1))
                                         (parent (token "*^" 'SpineSplit 6 2)
                                                 (list (leaf (token "*" 'NullInterpretation 7 2))
                                                       (leaf (token "*" 'NullInterpretation 8 3))
                                                       (leaf (token "*" 'NullInterpretation 9 3))
                                                       (leaf (token "*" 'NullInterpretation 10 4))
                                                       (leaf (token "4c" 'SpineData 11 4))
                                                       (leaf (token "4c" 'SpineData 12 4))
                                                       (leaf (token "4c" 'SpineData 13 4))
                                                       (leaf (token "=2" 'Measure 14 4))
                                                       (leaf (token "4c" 'SpineData 15 4))
                                                       (leaf (token "4c" 'SpineData 16 4))
                                                       (leaf (token "4c" 'SpineData 17 4))
                                                       (leaf (token "=3" 'Measure 18 4))
                                                       (leaf (token "4c" 'SpineData 19 4))
                                                       (leaf (token "4c" 'SpineData 20 4))
                                                       (leaf (token "4c" 'SpineData 21 4))
                                                       (leaf (token "*" 'NullInterpretation 22 4))
                                                       (leaf (token "*" 'NullInterpretation 23 4))
                                                       (leaf (token "*v" 'SpineJoin 24 4)))
                                                 (list (leaf (token "*" 'NullInterpretation 7 3))
                                                       (parent (token "*^" 'SpineSplit 8 4)
                                                               (list (leaf (token "*" 'NullInterpretation 9 4))
                                                                     (leaf (token "*" 'NullInterpretation 10 5))
                                                                     (leaf (token "4c" 'SpineData 11 5))
                                                                     (leaf (token "4c" 'SpineData 12 5))
                                                                     (leaf (token "4c" 'SpineData 13 5))
                                                                     (leaf (token "=2" 'Measure 14 5))
                                                                     (leaf (token "4c" 'SpineData 15 5))
                                                                     (leaf (token "4c" 'SpineData 16 5))
                                                                     (leaf (token "4c" 'SpineData 17 5))
                                                                     (leaf (token "=3" 'Measure 18 5))
                                                                     (leaf (token "4c" 'SpineData 19 5))
                                                                     (leaf (token "4c" 'SpineData 20 5))
                                                                     (leaf (token "4c" 'SpineData 21 5))
                                                                     (leaf (token "*" 'NullInterpretation 22 5))
                                                                     (leaf (token "*v" 'SpineJoin 23 5)))
                                                               (list (leaf (token "*" 'NullInterpretation 9 5))
                                                                     (parent (token "*^" 'SpineSplit 10 6)
                                                                             (list (leaf (token "4c" 'SpineData 11 6))
                                                                                   (leaf (token "4c" 'SpineData 12 6))
                                                                                   (leaf (token "4c" 'SpineData 13 6))
                                                                                   (leaf (token "=2" 'Measure 14 6))
                                                                                   (leaf (token "4c" 'SpineData 15 6))
                                                                                   (leaf (token "4c" 'SpineData 16 6))
                                                                                   (leaf (token "4c" 'SpineData 17 6))
                                                                                   (leaf (token "=3" 'Measure 18 6))
                                                                                   (leaf (token "4c" 'SpineData 19 6))
                                                                                   (leaf (token "4c" 'SpineData 20 6))
                                                                                   (leaf (token "4c" 'SpineData 21 6))
                                                                                   (leaf (token "*v" 'SpineJoin 22 6)))
                                                                             (list (leaf (token "4c" 'SpineData 11 7))
                                                                                   (leaf (token "4c" 'SpineData 12 7))
                                                                                   (leaf (token "4c" 'SpineData 13 7))
                                                                                   (leaf (token "=2" 'Measure 14 7))
                                                                                   (leaf (token "4c" 'SpineData 15 7))
                                                                                   (leaf (token "4c" 'SpineData 16 7))
                                                                                   (leaf (token "4c" 'SpineData 17 7))
                                                                                   (leaf (token "=3" 'Measure 18 7))
                                                                                   (leaf (token "4c" 'SpineData 19 7))
                                                                                   (leaf (token "4c" 'SpineData 20 7))
                                                                                   (leaf (token "4c" 'SpineData 21 7))
                                                                                   (leaf (token "*v" 'SpineJoin 22 7))))
                                                                     (leaf (token "*v" 'SpineJoin 23 6))))
                                                       (leaf (token "*v" 'SpineJoin 24 5))))
                                         (leaf (token "*" 'NullInterpretation 25 4))
                                         (leaf (token "*" 'NullInterpretation 26 3))
                                         (leaf (token "*" 'NullInterpretation 27 2))
                                         (leaf (token "==" 'Measure 28 1))
                                         (leaf (token "*-" 'SpineTerminator 29 1)))))))
              (path->hfile "../../data/count/two-spines-three-splits.krn"))
(check-expect (tokens->records (list (list (token "**kern" 'ExclusiveInterpretation 0 0)
                                      (token "**kern" 'ExclusiveInterpretation 0 1))
                                (list (token "*clefG2" 'Clef 1 0)
                                      (token "*clefG2" 'Clef 1 1))
                                (list (token "*k[]" 'KeySignature 2 0)
                                      (token "*k[]" 'KeySignature 2 1))
                                (list (token "*a:" 'KeyLabel 3 0)
                                      (token "*a:" 'KeyLabel 3 1))
                                (list (token "*M3/4" 'TimeSignature 4 0)
                                      (token "*M3/4" 'TimeSignature 4 1))
                                (list (token "*^" 'SpineSplit 5 0)
                                      (token "*" 'NullInterpretation 5 1))
                                (list (token "*" 'NullInterpretation 6 0)
                                      (token "*" 'NullInterpretation 6 1)
                                      (token "*^" 'SpineSplit 6 2))
                                (list (token "*" 'NullInterpretation 7 0)
                                      (token "*^" 'SpineSplit 7 1)
                                      (token "*" 'NullInterpretation 7 2)
                                      (token "*" 'NullInterpretation 7 3))
                                (list (token "*" 'NullInterpretation 8 0)
                                      (token "*" 'NullInterpretation 8 1)
                                      (token "*" 'NullInterpretation 8 2)
                                      (token "*" 'NullInterpretation 8 3)
                                      (token "*^" 'SpineSplit 8 4))
                                (list (token "*" 'NullInterpretation 9 0)
                                      (token "*" 'NullInterpretation 9 1)
                                      (token "*^" 'SpineSplit 9 2)
                                      (token "*" 'NullInterpretation 9 3)
                                      (token "*" 'NullInterpretation 9 4)
                                      (token "*" 'NullInterpretation 9 5))
                                (list (token "*" 'NullInterpretation 10 0)
                                      (token "*" 'NullInterpretation 10 1)
                                      (token "*" 'NullInterpretation 10 2)
                                      (token "*" 'NullInterpretation 10 3)
                                      (token "*" 'NullInterpretation 10 4)
                                      (token "*" 'NullInterpretation 10 5)
                                      (token "*^" 'SpineSplit 10 6))
                                (list (token "4c" 'SpineData 11 0)
                                      (token "4c" 'SpineData 11 1)
                                      (token "4c" 'SpineData 11 2)
                                      (token "4c" 'SpineData 11 3)
                                      (token "4c" 'SpineData 11 4)
                                      (token "4c" 'SpineData 11 5)
                                      (token "4c" 'SpineData 11 6)
                                      (token "4c" 'SpineData 11 7))
                                (list (token "4c" 'SpineData 12 0)
                                      (token "4c" 'SpineData 12 1)
                                      (token "4c" 'SpineData 12 2)
                                      (token "4c" 'SpineData 12 3)
                                      (token "4c" 'SpineData 12 4)
                                      (token "4c" 'SpineData 12 5)
                                      (token "4c" 'SpineData 12 6)
                                      (token "4c" 'SpineData 12 7))
                                (list (token "4c" 'SpineData 13 0)
                                      (token "4c" 'SpineData 13 1)
                                      (token "4c" 'SpineData 13 2)
                                      (token "4c" 'SpineData 13 3)
                                      (token "4c" 'SpineData 13 4)
                                      (token "4c" 'SpineData 13 5)
                                      (token "4c" 'SpineData 13 6)
                                      (token "4c" 'SpineData 13 7))
                                (list (token "=2" 'Measure 14 0)
                                      (token "=2" 'Measure 14 1)
                                      (token "=2" 'Measure 14 2)
                                      (token "=2" 'Measure 14 3)
                                      (token "=2" 'Measure 14 4)
                                      (token "=2" 'Measure 14 5)
                                      (token "=2" 'Measure 14 6)
                                      (token "=2" 'Measure 14 7))
                                (list (token "4c" 'SpineData 15 0)
                                      (token "4c" 'SpineData 15 1)
                                      (token "4c" 'SpineData 15 2)
                                      (token "4c" 'SpineData 15 3)
                                      (token "4c" 'SpineData 15 4)
                                      (token "4c" 'SpineData 15 5)
                                      (token "4c" 'SpineData 15 6)
                                      (token "4c" 'SpineData 15 7))
                                (list (token "4c" 'SpineData 16 0)
                                      (token "4c" 'SpineData 16 1)
                                      (token "4c" 'SpineData 16 2)
                                      (token "4c" 'SpineData 16 3)
                                      (token "4c" 'SpineData 16 4)
                                      (token "4c" 'SpineData 16 5)
                                      (token "4c" 'SpineData 16 6)
                                      (token "4c" 'SpineData 16 7))
                                (list (token "4c" 'SpineData 17 0)
                                      (token "4c" 'SpineData 17 1)
                                      (token "4c" 'SpineData 17 2)
                                      (token "4c" 'SpineData 17 3)
                                      (token "4c" 'SpineData 17 4)
                                      (token "4c" 'SpineData 17 5)
                                      (token "4c" 'SpineData 17 6)
                                      (token "4c" 'SpineData 17 7))
                                (list (token "=3" 'Measure 18 0)
                                      (token "=3" 'Measure 18 1)
                                      (token "=3" 'Measure 18 2)
                                      (token "=3" 'Measure 18 3)
                                      (token "=3" 'Measure 18 4)
                                      (token "=3" 'Measure 18 5)
                                      (token "=3" 'Measure 18 6)
                                      (token "=3" 'Measure 18 7))
                                (list (token "4c" 'SpineData 19 0)
                                      (token "4c" 'SpineData 19 1)
                                      (token "4c" 'SpineData 19 2)
                                      (token "4c" 'SpineData 19 3)
                                      (token "4c" 'SpineData 19 4)
                                      (token "4c" 'SpineData 19 5)
                                      (token "4c" 'SpineData 19 6)
                                      (token "4c" 'SpineData 19 7))
                                (list (token "4c" 'SpineData 20 0)
                                      (token "4c" 'SpineData 20 1)
                                      (token "4c" 'SpineData 20 2)
                                      (token "4c" 'SpineData 20 3)
                                      (token "4c" 'SpineData 20 4)
                                      (token "4c" 'SpineData 20 5)
                                      (token "4c" 'SpineData 20 6)
                                      (token "4c" 'SpineData 20 7))
                                (list (token "4c" 'SpineData 21 0)
                                      (token "4c" 'SpineData 21 1)
                                      (token "4c" 'SpineData 21 2)
                                      (token "4c" 'SpineData 21 3)
                                      (token "4c" 'SpineData 21 4)
                                      (token "4c" 'SpineData 21 5)
                                      (token "4c" 'SpineData 21 6)
                                      (token "4c" 'SpineData 21 7))
                                (list (token "*" 'NullInterpretation 22 0)
                                      (token "*" 'NullInterpretation 22 1)
                                      (token "*" 'NullInterpretation 22 2)
                                      (token "*" 'NullInterpretation 22 3)
                                      (token "*" 'NullInterpretation 22 4)
                                      (token "*" 'NullInterpretation 22 5)
                                      (token "*v" 'SpineJoin 22 6)
                                      (token "*v" 'SpineJoin 22 7))
                                (list (token "*" 'NullInterpretation 23 0)
                                      (token "*" 'NullInterpretation 23 1)
                                      (token "*" 'NullInterpretation 23 2)
                                      (token "*" 'NullInterpretation 23 3)
                                      (token "*" 'NullInterpretation 23 4)
                                      (token "*v" 'SpineJoin 23 5)
                                      (token "*v" 'SpineJoin 23 6))
                                (list (token "*" 'NullInterpretation 24 0)
                                      (token "*" 'NullInterpretation 24 1)
                                      (token "*" 'NullInterpretation 24 2)
                                      (token "*" 'NullInterpretation 24 3)
                                      (token "*v" 'SpineJoin 24 4)
                                      (token "*v" 'SpineJoin 24 5))
                                (list (token "*" 'NullInterpretation 25 0)
                                      (token "*" 'NullInterpretation 25 1)
                                      (token "*v" 'SpineJoin 25 2)
                                      (token "*v" 'SpineJoin 25 3)
                                      (token "*" 'NullInterpretation 25 4))
                                (list (token "*" 'NullInterpretation 26 0)
                                      (token "*v" 'SpineJoin 26 1)
                                      (token "*v" 'SpineJoin 26 2)
                                      (token "*" 'NullInterpretation 26 3))
                                (list (token "*v" 'SpineJoin 27 0)
                                      (token "*v" 'SpineJoin 27 1)
                                      (token "*" 'NullInterpretation 27 2))
                                (list (token "==" 'Measure 28 0)
                                      (token "==" 'Measure 28 1))
                                (list (token "*-" 'SpineTerminator 29 0)
                                      (token "*-" 'SpineTerminator 29 1))))
              (list (record "**kern\t**kern" 'ExclusiveInterpretation
                            (list (token "**kern" 'ExclusiveInterpretation 0 0)
                                  (token "**kern" 'ExclusiveInterpretation 0 1))
                            0)
                    (record "*clefG2\t*clefG2" 'TandemInterpretation
                            (list (token "*clefG2" 'Clef 1 0)
                                  (token "*clefG2" 'Clef 1 1))
                            1)
                    (record "*k[]\t*k[]" 'TandemInterpretation
                            (list (token "*k[]" 'KeySignature 2 0)
                                  (token "*k[]" 'KeySignature 2 1))
                            2)
                    (record "*a:\t*a:" 'TandemInterpretation
                            (list (token "*a:" 'KeyLabel 3 0)
                                  (token "*a:" 'KeyLabel 3 1))
                            3)
                    (record "*M3/4\t*M3/4" 'TandemInterpretation
                            (list (token "*M3/4" 'TimeSignature 4 0)
                                  (token "*M3/4" 'TimeSignature 4 1))
                            4)
                    (record "*^\t*" 'TandemInterpretation
                            (list (token "*^" 'SpineSplit 5 0)
                                  (token "*" 'NullInterpretation 5 1))
                            5)
                    (record "*\t*\t*^" 'TandemInterpretation
                            (list (token "*" 'NullInterpretation 6 0)
                                  (token "*" 'NullInterpretation 6 1)
                                  (token "*^" 'SpineSplit 6 2))
                            6)
                    (record "*\t*^\t*\t*" 'TandemInterpretation
                            (list (token "*" 'NullInterpretation 7 0)
                                  (token "*^" 'SpineSplit 7 1)
                                  (token "*" 'NullInterpretation 7 2)
                                  (token "*" 'NullInterpretation 7 3))
                            7)
                    (record "*\t*\t*\t*\t*^" 'TandemInterpretation
                            (list (token "*" 'NullInterpretation 8 0)
                                  (token "*" 'NullInterpretation 8 1)
                                  (token "*" 'NullInterpretation 8 2)
                                  (token "*" 'NullInterpretation 8 3)
                                  (token "*^" 'SpineSplit 8 4))
                            8)
                    (record "*\t*\t*^\t*\t*\t*" 'TandemInterpretation
                            (list (token "*" 'NullInterpretation 9 0)
                                  (token "*" 'NullInterpretation 9 1)
                                  (token "*^" 'SpineSplit 9 2)
                                  (token "*" 'NullInterpretation 9 3)
                                  (token "*" 'NullInterpretation 9 4)
                                  (token "*" 'NullInterpretation 9 5))
                            9)
                    (record "*\t*\t*\t*\t*\t*\t*^" 'TandemInterpretation
                            (list (token "*" 'NullInterpretation 10 0)
                                  (token "*" 'NullInterpretation 10 1)
                                  (token "*" 'NullInterpretation 10 2)
                                  (token "*" 'NullInterpretation 10 3)
                                  (token "*" 'NullInterpretation 10 4)
                                  (token "*" 'NullInterpretation 10 5)
                                  (token "*^" 'SpineSplit 10 6))
                            10)
                    (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                            (list (token "4c" 'SpineData 11 0)
                                  (token "4c" 'SpineData 11 1)
                                  (token "4c" 'SpineData 11 2)
                                  (token "4c" 'SpineData 11 3)
                                  (token "4c" 'SpineData 11 4)
                                  (token "4c" 'SpineData 11 5)
                                  (token "4c" 'SpineData 11 6)
                                  (token "4c" 'SpineData 11 7))
                            11)
                    (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                            (list (token "4c" 'SpineData 12 0)
                                  (token "4c" 'SpineData 12 1)
                                  (token "4c" 'SpineData 12 2)
                                  (token "4c" 'SpineData 12 3)
                                  (token "4c" 'SpineData 12 4)
                                  (token "4c" 'SpineData 12 5)
                                  (token "4c" 'SpineData 12 6)
                                  (token "4c" 'SpineData 12 7))
                            12)
                    (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                            (list (token "4c" 'SpineData 13 0)
                                  (token "4c" 'SpineData 13 1)
                                  (token "4c" 'SpineData 13 2)
                                  (token "4c" 'SpineData 13 3)
                                  (token "4c" 'SpineData 13 4)
                                  (token "4c" 'SpineData 13 5)
                                  (token "4c" 'SpineData 13 6)
                                  (token "4c" 'SpineData 13 7))
                            13)
                    (record "=2\t=2\t=2\t=2\t=2\t=2\t=2\t=2" 'Measure
                            (list (token "=2" 'Measure 14 0)
                                  (token "=2" 'Measure 14 1)
                                  (token "=2" 'Measure 14 2)
                                  (token "=2" 'Measure 14 3)
                                  (token "=2" 'Measure 14 4)
                                  (token "=2" 'Measure 14 5)
                                  (token "=2" 'Measure 14 6)
                                  (token "=2" 'Measure 14 7))
                            14)
                    (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                            (list (token "4c" 'SpineData 15 0)
                                  (token "4c" 'SpineData 15 1)
                                  (token "4c" 'SpineData 15 2)
                                  (token "4c" 'SpineData 15 3)
                                  (token "4c" 'SpineData 15 4)
                                  (token "4c" 'SpineData 15 5)
                                  (token "4c" 'SpineData 15 6)
                                  (token "4c" 'SpineData 15 7))
                            15)
                    (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                            (list (token "4c" 'SpineData 16 0)
                                  (token "4c" 'SpineData 16 1)
                                  (token "4c" 'SpineData 16 2)
                                  (token "4c" 'SpineData 16 3)
                                  (token "4c" 'SpineData 16 4)
                                  (token "4c" 'SpineData 16 5)
                                  (token "4c" 'SpineData 16 6)
                                  (token "4c" 'SpineData 16 7))
                            16)
                    (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                            (list (token "4c" 'SpineData 17 0)
                                  (token "4c" 'SpineData 17 1)
                                  (token "4c" 'SpineData 17 2)
                                  (token "4c" 'SpineData 17 3)
                                  (token "4c" 'SpineData 17 4)
                                  (token "4c" 'SpineData 17 5)
                                  (token "4c" 'SpineData 17 6)
                                  (token "4c" 'SpineData 17 7))
                            17)
                    (record "=3\t=3\t=3\t=3\t=3\t=3\t=3\t=3" 'Measure
                            (list (token "=3" 'Measure 18 0)
                                  (token "=3" 'Measure 18 1)
                                  (token "=3" 'Measure 18 2)
                                  (token "=3" 'Measure 18 3)
                                  (token "=3" 'Measure 18 4)
                                  (token "=3" 'Measure 18 5)
                                  (token "=3" 'Measure 18 6)
                                  (token "=3" 'Measure 18 7))
                            18)
                    (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                            (list (token "4c" 'SpineData 19 0)
                                  (token "4c" 'SpineData 19 1)
                                  (token "4c" 'SpineData 19 2)
                                  (token "4c" 'SpineData 19 3)
                                  (token "4c" 'SpineData 19 4)
                                  (token "4c" 'SpineData 19 5)
                                  (token "4c" 'SpineData 19 6)
                                  (token "4c" 'SpineData 19 7))
                            19)
                    (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                            (list (token "4c" 'SpineData 20 0)
                                  (token "4c" 'SpineData 20 1)
                                  (token "4c" 'SpineData 20 2)
                                  (token "4c" 'SpineData 20 3)
                                  (token "4c" 'SpineData 20 4)
                                  (token "4c" 'SpineData 20 5)
                                  (token "4c" 'SpineData 20 6)
                                  (token "4c" 'SpineData 20 7))
                            20)
                    (record "4c\t4c\t4c\t4c\t4c\t4c\t4c\t4c" 'Token
                            (list (token "4c" 'SpineData 21 0)
                                  (token "4c" 'SpineData 21 1)
                                  (token "4c" 'SpineData 21 2)
                                  (token "4c" 'SpineData 21 3)
                                  (token "4c" 'SpineData 21 4)
                                  (token "4c" 'SpineData 21 5)
                                  (token "4c" 'SpineData 21 6)
                                  (token "4c" 'SpineData 21 7))
                            21)
                    (record "*\t*\t*\t*\t*\t*\t*v\t*v" 'TandemInterpretation
                            (list (token "*" 'NullInterpretation 22 0)
                                  (token "*" 'NullInterpretation 22 1)
                                  (token "*" 'NullInterpretation 22 2)
                                  (token "*" 'NullInterpretation 22 3)
                                  (token "*" 'NullInterpretation 22 4)
                                  (token "*" 'NullInterpretation 22 5)
                                  (token "*v" 'SpineJoin 22 6)
                                  (token "*v" 'SpineJoin 22 7))
                            22)
                    (record "*\t*\t*\t*\t*\t*v\t*v" 'TandemInterpretation
                            (list (token "*" 'NullInterpretation 23 0)
                                  (token "*" 'NullInterpretation 23 1)
                                  (token "*" 'NullInterpretation 23 2)
                                  (token "*" 'NullInterpretation 23 3)
                                  (token "*" 'NullInterpretation 23 4)
                                  (token "*v" 'SpineJoin 23 5)
                                  (token "*v" 'SpineJoin 23 6))
                            23)
                    (record "*\t*\t*\t*\t*v\t*v" 'TandemInterpretation
                            (list (token "*" 'NullInterpretation 24 0)
                                  (token "*" 'NullInterpretation 24 1)
                                  (token "*" 'NullInterpretation 24 2)
                                  (token "*" 'NullInterpretation 24 3)
                                  (token "*v" 'SpineJoin 24 4)
                                  (token "*v" 'SpineJoin 24 5))
                            24)
                    (record "*\t*\t*v\t*v\t*" 'TandemInterpretation
                            (list (token "*" 'NullInterpretation 25 0)
                                  (token "*" 'NullInterpretation 25 1)
                                  (token "*v" 'SpineJoin 25 2)
                                  (token "*v" 'SpineJoin 25 3)
                                  (token "*" 'NullInterpretation 25 4))
                            25)
                    (record "*\t*v\t*v\t*" 'TandemInterpretation
                            (list (token "*" 'NullInterpretation 26 0)
                                  (token "*v" 'SpineJoin 26 1)
                                  (token "*v" 'SpineJoin 26 2)
                                  (token "*" 'NullInterpretation 26 3))
                            26)
                    (record "*v\t*v\t*" 'TandemInterpretation (list (token "*v" 'SpineJoin 27 0)
                                                    (token "*v" 'SpineJoin 27 1)
                                                    (token "*" 'NullInterpretation 27 2))
                            27)
                    (record "==\t==" 'Measure (list (token "==" 'Measure 28 0)
                                                 (token "==" 'Measure 28 1))
                            28)
                    (record "*-\t*-" 'TandemInterpretation (list (token "*-" 'SpineTerminator 29 0)
                                                 (token "*-" 'SpineTerminator 29 1))
                            29)))
(check-expect (hgraph->tokens
               (hgraph (root (list (list (leaf (token "**kern" 'ExclusiveInterpretation 0 0))
                                         (leaf (token "*clefG2" 'Clef 1 0))
                                         (leaf (token "*k[]" 'KeySignature 2 0))
                                         (leaf (token "*a:" 'KeyLabel 3 0))
                                         (leaf (token "*M3/4" 'TimeSignature 4 0))
                                         (parent (token "*^" 'SpineSplit 5 0)
                                                 (list (leaf (token "*" 'NullInterpretation 6 0))
                                                       (leaf (token "*" 'NullInterpretation 7 0))
                                                       (leaf (token "*" 'NullInterpretation 8 0))
                                                       (leaf (token "*" 'NullInterpretation 9 0))
                                                       (leaf (token "*" 'NullInterpretation 10 0))
                                                       (leaf (token "4c" 'SpineData 11 0))
                                                       (leaf (token "4c" 'SpineData 12 0))
                                                       (leaf (token "4c" 'SpineData 13 0))
                                                       (leaf (token "=2" 'Measure 14 0))
                                                       (leaf (token "4c" 'SpineData 15 0))
                                                       (leaf (token "4c" 'SpineData 16 0))
                                                       (leaf (token "4c" 'SpineData 17 0))
                                                       (leaf (token "=3" 'Measure 18 0))
                                                       (leaf (token "4c" 'SpineData 19 0))
                                                       (leaf (token "4c" 'SpineData 20 0))
                                                       (leaf (token "4c" 'SpineData 21 0))
                                                       (leaf (token "*" 'NullInterpretation 22 0))
                                                       (leaf (token "*" 'NullInterpretation 23 0))
                                                       (leaf (token "*" 'NullInterpretation 24 0))
                                                       (leaf (token "*" 'NullInterpretation 25 0))
                                                       (leaf (token "*" 'NullInterpretation 26 0))
                                                       (leaf (token "*v" 'SpineJoin 27 0)))
                                                 (list (leaf (token "*" 'NullInterpretation 6 1))
                                                       (parent (token "*^" 'SpineSplit 7 1)
                                                               (list (leaf (token "*" 'NullInterpretation 8 1))
                                                                     (leaf (token "*" 'NullInterpretation 9 1))
                                                                     (leaf (token "*" 'NullInterpretation 10 1))
                                                                     (leaf (token "4c" 'SpineData 11 1))
                                                                     (leaf (token "4c" 'SpineData 12 1))
                                                                     (leaf (token "4c" 'SpineData 13 1))
                                                                     (leaf (token "=2" 'Measure 14 1))
                                                                     (leaf (token "4c" 'SpineData 15 1))
                                                                     (leaf (token "4c" 'SpineData 16 1))
                                                                     (leaf (token "4c" 'SpineData 17 1))
                                                                     (leaf (token "=3" 'Measure 18 1))
                                                                     (leaf (token "4c" 'SpineData 19 1))
                                                                     (leaf (token "4c" 'SpineData 20 1))
                                                                     (leaf (token "4c" 'SpineData 21 1))
                                                                     (leaf (token "*" 'NullInterpretation 22 1))
                                                                     (leaf (token "*" 'NullInterpretation 23 1))
                                                                     (leaf (token "*" 'NullInterpretation 24 1))
                                                                     (leaf (token "*" 'NullInterpretation 25 1))
                                                                     (leaf (token "*v" 'SpineJoin 26 1)))
                                                               (list (leaf (token "*" 'NullInterpretation 8 2))
                                                                     (parent (token "*^" 'SpineSplit 9 2)
                                                                             (list (leaf (token "*" 'NullInterpretation 10 2))
                                                                                   (leaf (token "4c" 'SpineData 11 2))
                                                                                   (leaf (token "4c" 'SpineData 12 2))
                                                                                   (leaf (token "4c" 'SpineData 13 2))
                                                                                   (leaf (token "=2" 'Measure 14 2))
                                                                                   (leaf (token "4c" 'SpineData 15 2))
                                                                                   (leaf (token "4c" 'SpineData 16 2))
                                                                                   (leaf (token "4c" 'SpineData 17 2))
                                                                                   (leaf (token "=3" 'Measure 18 2))
                                                                                   (leaf (token "4c" 'SpineData 19 2))
                                                                                   (leaf (token "4c" 'SpineData 20 2))
                                                                                   (leaf (token "4c" 'SpineData 21 2))
                                                                                   (leaf (token "*" 'NullInterpretation 22 2))
                                                                                   (leaf (token "*" 'NullInterpretation 23 2))
                                                                                   (leaf (token "*" 'NullInterpretation 24 2))
                                                                                   (leaf (token "*v" 'SpineJoin 25 2)))
                                                                             (list (leaf (token "*" 'NullInterpretation 10 3))
                                                                                   (leaf (token "4c" 'SpineData 11 3))
                                                                                   (leaf (token "4c" 'SpineData 12 3))
                                                                                   (leaf (token "4c" 'SpineData 13 3))
                                                                                   (leaf (token "=2" 'Measure 14 3))
                                                                                   (leaf (token "4c" 'SpineData 15 3))
                                                                                   (leaf (token "4c" 'SpineData 16 3))
                                                                                   (leaf (token "4c" 'SpineData 17 3))
                                                                                   (leaf (token "=3" 'Measure 18 3))
                                                                                   (leaf (token "4c" 'SpineData 19 3))
                                                                                   (leaf (token "4c" 'SpineData 20 3))
                                                                                   (leaf (token "4c" 'SpineData 21 3))
                                                                                   (leaf (token "*" 'NullInterpretation 22 3))
                                                                                   (leaf (token "*" 'NullInterpretation 23 3))
                                                                                   (leaf (token "*" 'NullInterpretation 24 3))
                                                                                   (leaf (token "*v" 'SpineJoin 25 3))))
                                                                     (leaf (token "*v" 'SpineJoin 26 2))))
                                                       (leaf (token "*v" 'SpineJoin 27 1))))
                                         (leaf (token "==" 'Measure 28 0))
                                         (leaf (token "*-" 'SpineTerminator 29 0)))
                                   (list (leaf (token "**kern" 'ExclusiveInterpretation 0 1))
                                         (leaf (token "*clefG2" 'Clef 1 1))
                                         (leaf (token "*k[]" 'KeySignature 2 1))
                                         (leaf (token "*a:" 'KeyLabel 3 1))
                                         (leaf (token "*M3/4" 'TimeSignature 4 1))
                                         (leaf (token "*" 'NullInterpretation 5 1))
                                         (parent (token "*^" 'SpineSplit 6 2)
                                                 (list (leaf (token "*" 'NullInterpretation 7 2))
                                                       (leaf (token "*" 'NullInterpretation 8 3))
                                                       (leaf (token "*" 'NullInterpretation 9 3))
                                                       (leaf (token "*" 'NullInterpretation 10 4))
                                                       (leaf (token "4c" 'SpineData 11 4))
                                                       (leaf (token "4c" 'SpineData 12 4))
                                                       (leaf (token "4c" 'SpineData 13 4))
                                                       (leaf (token "=2" 'Measure 14 4))
                                                       (leaf (token "4c" 'SpineData 15 4))
                                                       (leaf (token "4c" 'SpineData 16 4))
                                                       (leaf (token "4c" 'SpineData 17 4))
                                                       (leaf (token "=3" 'Measure 18 4))
                                                       (leaf (token "4c" 'SpineData 19 4))
                                                       (leaf (token "4c" 'SpineData 20 4))
                                                       (leaf (token "4c" 'SpineData 21 4))
                                                       (leaf (token "*" 'NullInterpretation 22 4))
                                                       (leaf (token "*" 'NullInterpretation 23 4))
                                                       (leaf (token "*v" 'SpineJoin 24 4)))
                                                 (list (leaf (token "*" 'NullInterpretation 7 3))
                                                       (parent (token "*^" 'SpineSplit 8 4)
                                                               (list (leaf (token "*" 'NullInterpretation 9 4))
                                                                     (leaf (token "*" 'NullInterpretation 10 5))
                                                                     (leaf (token "4c" 'SpineData 11 5))
                                                                     (leaf (token "4c" 'SpineData 12 5))
                                                                     (leaf (token "4c" 'SpineData 13 5))
                                                                     (leaf (token "=2" 'Measure 14 5))
                                                                     (leaf (token "4c" 'SpineData 15 5))
                                                                     (leaf (token "4c" 'SpineData 16 5))
                                                                     (leaf (token "4c" 'SpineData 17 5))
                                                                     (leaf (token "=3" 'Measure 18 5))
                                                                     (leaf (token "4c" 'SpineData 19 5))
                                                                     (leaf (token "4c" 'SpineData 20 5))
                                                                     (leaf (token "4c" 'SpineData 21 5))
                                                                     (leaf (token "*" 'NullInterpretation 22 5))
                                                                     (leaf (token "*v" 'SpineJoin 23 5)))
                                                               (list (leaf (token "*" 'NullInterpretation 9 5))
                                                                     (parent (token "*^" 'SpineSplit 10 6)
                                                                             (list (leaf (token "4c" 'SpineData 11 6))
                                                                                   (leaf (token "4c" 'SpineData 12 6))
                                                                                   (leaf (token "4c" 'SpineData 13 6))
                                                                                   (leaf (token "=2" 'Measure 14 6))
                                                                                   (leaf (token "4c" 'SpineData 15 6))
                                                                                   (leaf (token "4c" 'SpineData 16 6))
                                                                                   (leaf (token "4c" 'SpineData 17 6))
                                                                                   (leaf (token "=3" 'Measure 18 6))
                                                                                   (leaf (token "4c" 'SpineData 19 6))
                                                                                   (leaf (token "4c" 'SpineData 20 6))
                                                                                   (leaf (token "4c" 'SpineData 21 6))
                                                                                   (leaf (token "*v" 'SpineJoin 22 6)))
                                                                             (list (leaf (token "4c" 'SpineData 11 7))
                                                                                   (leaf (token "4c" 'SpineData 12 7))
                                                                                   (leaf (token "4c" 'SpineData 13 7))
                                                                                   (leaf (token "=2" 'Measure 14 7))
                                                                                   (leaf (token "4c" 'SpineData 15 7))
                                                                                   (leaf (token "4c" 'SpineData 16 7))
                                                                                   (leaf (token "4c" 'SpineData 17 7))
                                                                                   (leaf (token "=3" 'Measure 18 7))
                                                                                   (leaf (token "4c" 'SpineData 19 7))
                                                                                   (leaf (token "4c" 'SpineData 20 7))
                                                                                   (leaf (token "4c" 'SpineData 21 7))
                                                                                   (leaf (token "*v" 'SpineJoin 22 7))))
                                                                     (leaf (token "*v" 'SpineJoin 23 6))))
                                                       (leaf (token "*v" 'SpineJoin 24 5))))
                                         (leaf (token "*" 'NullInterpretation 25 4))
                                         (leaf (token "*" 'NullInterpretation 26 3))
                                         (leaf (token "*" 'NullInterpretation 27 2))
                                         (leaf (token "==" 'Measure 28 1))
                                         (leaf (token "*-" 'SpineTerminator 29 1)))))))
              (list (list (token "**kern" 'ExclusiveInterpretation 0 0)
                          (token "**kern" 'ExclusiveInterpretation 0 1))
                    (list (token "*clefG2" 'Clef 1 0)
                          (token "*clefG2" 'Clef 1 1))
                    (list (token "*k[]" 'KeySignature 2 0)
                          (token "*k[]" 'KeySignature 2 1))
                    (list (token "*a:" 'KeyLabel 3 0)
                          (token "*a:" 'KeyLabel 3 1))
                    (list (token "*M3/4" 'TimeSignature 4 0)
                          (token "*M3/4" 'TimeSignature 4 1))
                    (list (token "*^" 'SpineSplit 5 0)
                          (token "*" 'NullInterpretation 5 1))
                    (list (token "*" 'NullInterpretation 6 0)
                          (token "*" 'NullInterpretation 6 1)
                          (token "*^" 'SpineSplit 6 2))
                    (list (token "*" 'NullInterpretation 7 0)
                          (token "*^" 'SpineSplit 7 1)
                          (token "*" 'NullInterpretation 7 2)
                          (token "*" 'NullInterpretation 7 3))
                    (list (token "*" 'NullInterpretation 8 0)
                          (token "*" 'NullInterpretation 8 1)
                          (token "*" 'NullInterpretation 8 2)
                          (token "*" 'NullInterpretation 8 3)
                          (token "*^" 'SpineSplit 8 4))
                    (list (token "*" 'NullInterpretation 9 0)
                          (token "*" 'NullInterpretation 9 1)
                          (token "*^" 'SpineSplit 9 2)
                          (token "*" 'NullInterpretation 9 3)
                          (token "*" 'NullInterpretation 9 4)
                          (token "*" 'NullInterpretation 9 5))
                    (list (token "*" 'NullInterpretation 10 0)
                          (token "*" 'NullInterpretation 10 1)
                          (token "*" 'NullInterpretation 10 2)
                          (token "*" 'NullInterpretation 10 3)
                          (token "*" 'NullInterpretation 10 4)
                          (token "*" 'NullInterpretation 10 5)
                          (token "*^" 'SpineSplit 10 6))
                    (list (token "4c" 'SpineData 11 0)
                          (token "4c" 'SpineData 11 1)
                          (token "4c" 'SpineData 11 2)
                          (token "4c" 'SpineData 11 3)
                          (token "4c" 'SpineData 11 4)
                          (token "4c" 'SpineData 11 5)
                          (token "4c" 'SpineData 11 6)
                          (token "4c" 'SpineData 11 7))
                    (list (token "4c" 'SpineData 12 0)
                          (token "4c" 'SpineData 12 1)
                          (token "4c" 'SpineData 12 2)
                          (token "4c" 'SpineData 12 3)
                          (token "4c" 'SpineData 12 4)
                          (token "4c" 'SpineData 12 5)
                          (token "4c" 'SpineData 12 6)
                          (token "4c" 'SpineData 12 7))
                    (list (token "4c" 'SpineData 13 0)
                          (token "4c" 'SpineData 13 1)
                          (token "4c" 'SpineData 13 2)
                          (token "4c" 'SpineData 13 3)
                          (token "4c" 'SpineData 13 4)
                          (token "4c" 'SpineData 13 5)
                          (token "4c" 'SpineData 13 6)
                          (token "4c" 'SpineData 13 7))
                    (list (token "=2" 'Measure 14 0)
                          (token "=2" 'Measure 14 1)
                          (token "=2" 'Measure 14 2)
                          (token "=2" 'Measure 14 3)
                          (token "=2" 'Measure 14 4)
                          (token "=2" 'Measure 14 5)
                          (token "=2" 'Measure 14 6)
                          (token "=2" 'Measure 14 7))
                    (list (token "4c" 'SpineData 15 0)
                          (token "4c" 'SpineData 15 1)
                          (token "4c" 'SpineData 15 2)
                          (token "4c" 'SpineData 15 3)
                          (token "4c" 'SpineData 15 4)
                          (token "4c" 'SpineData 15 5)
                          (token "4c" 'SpineData 15 6)
                          (token "4c" 'SpineData 15 7))
                    (list (token "4c" 'SpineData 16 0)
                          (token "4c" 'SpineData 16 1)
                          (token "4c" 'SpineData 16 2)
                          (token "4c" 'SpineData 16 3)
                          (token "4c" 'SpineData 16 4)
                          (token "4c" 'SpineData 16 5)
                          (token "4c" 'SpineData 16 6)
                          (token "4c" 'SpineData 16 7))
                    (list (token "4c" 'SpineData 17 0)
                          (token "4c" 'SpineData 17 1)
                          (token "4c" 'SpineData 17 2)
                          (token "4c" 'SpineData 17 3)
                          (token "4c" 'SpineData 17 4)
                          (token "4c" 'SpineData 17 5)
                          (token "4c" 'SpineData 17 6)
                          (token "4c" 'SpineData 17 7))
                    (list (token "=3" 'Measure 18 0)
                          (token "=3" 'Measure 18 1)
                          (token "=3" 'Measure 18 2)
                          (token "=3" 'Measure 18 3)
                          (token "=3" 'Measure 18 4)
                          (token "=3" 'Measure 18 5)
                          (token "=3" 'Measure 18 6)
                          (token "=3" 'Measure 18 7))
                    (list (token "4c" 'SpineData 19 0)
                          (token "4c" 'SpineData 19 1)
                          (token "4c" 'SpineData 19 2)
                          (token "4c" 'SpineData 19 3)
                          (token "4c" 'SpineData 19 4)
                          (token "4c" 'SpineData 19 5)
                          (token "4c" 'SpineData 19 6)
                          (token "4c" 'SpineData 19 7))
                    (list (token "4c" 'SpineData 20 0)
                          (token "4c" 'SpineData 20 1)
                          (token "4c" 'SpineData 20 2)
                          (token "4c" 'SpineData 20 3)
                          (token "4c" 'SpineData 20 4)
                          (token "4c" 'SpineData 20 5)
                          (token "4c" 'SpineData 20 6)
                          (token "4c" 'SpineData 20 7))
                    (list (token "4c" 'SpineData 21 0)
                          (token "4c" 'SpineData 21 1)
                          (token "4c" 'SpineData 21 2)
                          (token "4c" 'SpineData 21 3)
                          (token "4c" 'SpineData 21 4)
                          (token "4c" 'SpineData 21 5)
                          (token "4c" 'SpineData 21 6)
                          (token "4c" 'SpineData 21 7))
                    (list (token "*" 'NullInterpretation 22 0)
                          (token "*" 'NullInterpretation 22 1)
                          (token "*" 'NullInterpretation 22 2)
                          (token "*" 'NullInterpretation 22 3)
                          (token "*" 'NullInterpretation 22 4)
                          (token "*" 'NullInterpretation 22 5)
                          (token "*v" 'SpineJoin 22 6)
                          (token "*v" 'SpineJoin 22 7))
                    (list (token "*" 'NullInterpretation 23 0)
                          (token "*" 'NullInterpretation 23 1)
                          (token "*" 'NullInterpretation 23 2)
                          (token "*" 'NullInterpretation 23 3)
                          (token "*" 'NullInterpretation 23 4)
                          (token "*v" 'SpineJoin 23 5)
                          (token "*v" 'SpineJoin 23 6))
                    (list (token "*" 'NullInterpretation 24 0)
                          (token "*" 'NullInterpretation 24 1)
                          (token "*" 'NullInterpretation 24 2)
                          (token "*" 'NullInterpretation 24 3)
                          (token "*v" 'SpineJoin 24 4)
                          (token "*v" 'SpineJoin 24 5))
                    (list (token "*" 'NullInterpretation 25 0)
                          (token "*" 'NullInterpretation 25 1)
                          (token "*v" 'SpineJoin 25 2)
                          (token "*v" 'SpineJoin 25 3)
                          (token "*" 'NullInterpretation 25 4))
                    (list (token "*" 'NullInterpretation 26 0)
                          (token "*v" 'SpineJoin 26 1)
                          (token "*v" 'SpineJoin 26 2)
                          (token "*" 'NullInterpretation 26 3))
                    (list (token "*v" 'SpineJoin 27 0)
                          (token "*v" 'SpineJoin 27 1)
                          (token "*" 'NullInterpretation 27 2))
                    (list (token "==" 'Measure 28 0)
                          (token "==" 'Measure 28 1))
                    (list (token "*-" 'SpineTerminator 29 0)
                          (token "*-" 'SpineTerminator 29 1))))
#|
(check-expect (hfile->hgraph (path->hfile "../../data/count/two-spines-three-splits.krn"))
              (hgraph (root (list (list (leaf (token "**kern" 'ExclusiveInterpretation 0 0))
                                        (leaf (token "*clefG2" 'Clef 1 0))
                                        (leaf (token "*k[]" 'KeySignature 2 0))
                                        (leaf (token "*a:" 'KeyLabel 3 0))
                                        (leaf (token "*M3/4" 'TimeSignature 4 0))
                                        (parent (token "*^" 'SpineSplit 5 0)
                                                (list (leaf (token "*" 'NullInterpretation 6 0))
                                                      (leaf (token "*" 'NullInterpretation 7 0))
                                                      (leaf (token "*" 'NullInterpretation 8 0))
                                                      (leaf (token "*" 'NullInterpretation 9 0))
                                                      (leaf (token "*" 'NullInterpretation 10 0))
                                                      (leaf (token "4c" 'SpineData 11 0))
                                                      (leaf (token "4c" 'SpineData 12 0))
                                                      (leaf (token "4c" 'SpineData 13 0))
                                                      (leaf (token "=2" 'Measure 14 0))
                                                      (leaf (token "4c" 'SpineData 15 0))
                                                      (leaf (token "4c" 'SpineData 16 0))
                                                      (leaf (token "4c" 'SpineData 17 0))
                                                      (leaf (token "=3" 'Measure 18 0))
                                                      (leaf (token "4c" 'SpineData 19 0))
                                                      (leaf (token "4c" 'SpineData 20 0))
                                                      (leaf (token "4c" 'SpineData 21 0))
                                                      (leaf (token "*" 'NullInterpretation 22 0))
                                                      (leaf (token "*" 'NullInterpretation 23 0))
                                                      (leaf (token "*" 'NullInterpretation 24 0))
                                                      (leaf (token "*" 'NullInterpretation 25 0))
                                                      (leaf (token "*" 'NullInterpretation 26 0))
                                                      (leaf (token "*v" 'SpineJoin 27 0)))
                                                (list (leaf (token "*" 'NullInterpretation 6 1))
                                                      (parent (token "*^" 'SpineSplit 7 1)
                                                              (list (leaf (token "*" 'NullInterpretation 8 1))
                                                                    (leaf (token "*" 'NullInterpretation 9 1))
                                                                    (leaf (token "*" 'NullInterpretation 10 1))
                                                                    (leaf (token "4c" 'SpineData 11 1))
                                                                    (leaf (token "4c" 'SpineData 12 1))
                                                                    (leaf (token "4c" 'SpineData 13 1))
                                                                    (leaf (token "=2" 'Measure 14 1))
                                                                    (leaf (token "4c" 'SpineData 15 1))
                                                                    (leaf (token "4c" 'SpineData 16 1))
                                                                    (leaf (token "4c" 'SpineData 17 1))
                                                                    (leaf (token "=3" 'Measure 18 1))
                                                                    (leaf (token "4c" 'SpineData 19 1))
                                                                    (leaf (token "4c" 'SpineData 20 1))
                                                                    (leaf (token "4c" 'SpineData 21 1))
                                                                    (leaf (token "*" 'NullInterpretation 22 1))
                                                                    (leaf (token "*" 'NullInterpretation 23 1))
                                                                    (leaf (token "*" 'NullInterpretation 24 1))
                                                                    (leaf (token "*" 'NullInterpretation 25 1))
                                                                    (leaf (token "*v" 'SpineJoin 26 1)))
                                                              (list (leaf (token "*" 'NullInterpretation 8 2))
                                                                    (parent (token "*^" 'SpineSplit 9 2)
                                                                            (list (leaf (token "*" 'NullInterpretation 10 2))
                                                                                  (leaf (token "4c" 'SpineData 11 2))
                                                                                  (leaf (token "4c" 'SpineData 12 2))
                                                                                  (leaf (token "4c" 'SpineData 13 2))
                                                                                  (leaf (token "=2" 'Measure 14 2))
                                                                                  (leaf (token "4c" 'SpineData 15 2))
                                                                                  (leaf (token "4c" 'SpineData 16 2))
                                                                                  (leaf (token "4c" 'SpineData 17 2))
                                                                                  (leaf (token "=3" 'Measure 18 2))
                                                                                  (leaf (token "4c" 'SpineData 19 2))
                                                                                  (leaf (token "4c" 'SpineData 20 2))
                                                                                  (leaf (token "4c" 'SpineData 21 2))
                                                                                  (leaf (token "*" 'NullInterpretation 22 2))
                                                                                  (leaf (token "*" 'NullInterpretation 23 2))
                                                                                  (leaf (token "*" 'NullInterpretation 24 2))
                                                                                  (leaf (token "*v" 'SpineJoin 25 2)))
                                                                            (list (leaf (token "*" 'NullInterpretation 10 3))
                                                                                  (leaf (token "4c" 'SpineData 11 3))
                                                                                  (leaf (token "4c" 'SpineData 12 3))
                                                                                  (leaf (token "4c" 'SpineData 13 3))
                                                                                  (leaf (token "=2" 'Measure 14 3))
                                                                                  (leaf (token "4c" 'SpineData 15 3))
                                                                                  (leaf (token "4c" 'SpineData 16 3))
                                                                                  (leaf (token "4c" 'SpineData 17 3))
                                                                                  (leaf (token "=3" 'Measure 18 3))
                                                                                  (leaf (token "4c" 'SpineData 19 3))
                                                                                  (leaf (token "4c" 'SpineData 20 3))
                                                                                  (leaf (token "4c" 'SpineData 21 3))
                                                                                  (leaf (token "*" 'NullInterpretation 22 3))
                                                                                  (leaf (token "*" 'NullInterpretation 23 3))
                                                                                  (leaf (token "*" 'NullInterpretation 24 3))
                                                                                  (leaf (token "*v" 'SpineJoin 25 3))))
                                                                    (leaf (token "*v" 'SpineJoin 26 2))))
                                                      (leaf (token "*v" 'SpineJoin 27 1))))
                                        (leaf (token "==" 'Measure 28 0))
                                        (leaf (token "*-" 'SpineTerminator 29 0)))
                                  (list (leaf (token "**kern" 'ExclusiveInterpretation 0 1))
                                        (leaf (token "*clefG2" 'Clef 1 1))
                                        (leaf (token "*k[]" 'KeySignature 2 1))
                                        (leaf (token "*a:" 'KeyLabel 3 1))
                                        (leaf (token "*M3/4" 'TimeSignature 4 1))
                                        (leaf (token "*" 'NullInterpretation 5 1))
                                        (parent (token "*^" 'SpineSplit 6 2)
                                                (list (leaf (token "*" 'NullInterpretation 7 2))
                                                      (leaf (token "*" 'NullInterpretation 8 3))
                                                      (leaf (token "*" 'NullInterpretation 9 3))
                                                      (leaf (token "*" 'NullInterpretation 10 4))
                                                      (leaf (token "4c" 'SpineData 11 4))
                                                      (leaf (token "4c" 'SpineData 12 4))
                                                      (leaf (token "4c" 'SpineData 13 4))
                                                      (leaf (token "=2" 'Measure 14 4))
                                                      (leaf (token "4c" 'SpineData 15 4))
                                                      (leaf (token "4c" 'SpineData 16 4))
                                                      (leaf (token "4c" 'SpineData 17 4))
                                                      (leaf (token "=3" 'Measure 18 4))
                                                      (leaf (token "4c" 'SpineData 19 4))
                                                      (leaf (token "4c" 'SpineData 20 4))
                                                      (leaf (token "4c" 'SpineData 21 4))
                                                      (leaf (token "*" 'NullInterpretation 22 4))
                                                      (leaf (token "*" 'NullInterpretation 23 4))
                                                      (leaf (token "*v" 'SpineJoin 24 4)))
                                                (list (leaf (token "*" 'NullInterpretation 7 3))
                                                      (parent (token "*^" 'SpineSplit 8 4)
                                                              (list (leaf (token "*" 'NullInterpretation 9 4))
                                                                    (leaf (token "*" 'NullInterpretation 10 5))
                                                                    (leaf (token "4c" 'SpineData 11 5))
                                                                    (leaf (token "4c" 'SpineData 12 5))
                                                                    (leaf (token "4c" 'SpineData 13 5))
                                                                    (leaf (token "=2" 'Measure 14 5))
                                                                    (leaf (token "4c" 'SpineData 15 5))
                                                                    (leaf (token "4c" 'SpineData 16 5))
                                                                    (leaf (token "4c" 'SpineData 17 5))
                                                                    (leaf (token "=3" 'Measure 18 5))
                                                                    (leaf (token "4c" 'SpineData 19 5))
                                                                    (leaf (token "4c" 'SpineData 20 5))
                                                                    (leaf (token "4c" 'SpineData 21 5))
                                                                    (leaf (token "*" 'NullInterpretation 22 5))
                                                                    (leaf (token "*v" 'SpineJoin 23 5)))
                                                              (list (leaf (token "*" 'NullInterpretation 9 5))
                                                                    (parent (token "*^" 'SpineSplit 10 6)
                                                                            (list (leaf (token "4c" 'SpineData 11 6))
                                                                                  (leaf (token "4c" 'SpineData 12 6))
                                                                                  (leaf (token "4c" 'SpineData 13 6))
                                                                                  (leaf (token "=2" 'Measure 14 6))
                                                                                  (leaf (token "4c" 'SpineData 15 6))
                                                                                  (leaf (token "4c" 'SpineData 16 6))
                                                                                  (leaf (token "4c" 'SpineData 17 6))
                                                                                  (leaf (token "=3" 'Measure 18 6))
                                                                                  (leaf (token "4c" 'SpineData 19 6))
                                                                                  (leaf (token "4c" 'SpineData 20 6))
                                                                                  (leaf (token "4c" 'SpineData 21 6))
                                                                                  (leaf (token "*v" 'SpineJoin 22 6)))
                                                                            (list (leaf (token "4c" 'SpineData 11 7))
                                                                                  (leaf (token "4c" 'SpineData 12 7))
                                                                                  (leaf (token "4c" 'SpineData 13 7))
                                                                                  (leaf (token "=2" 'Measure 14 7))
                                                                                  (leaf (token "4c" 'SpineData 15 7))
                                                                                  (leaf (token "4c" 'SpineData 16 7))
                                                                                  (leaf (token "4c" 'SpineData 17 7))
                                                                                  (leaf (token "=3" 'Measure 18 7))
                                                                                  (leaf (token "4c" 'SpineData 19 7))
                                                                                  (leaf (token "4c" 'SpineData 20 7))
                                                                                  (leaf (token "4c" 'SpineData 21 7))
                                                                                  (leaf (token "*v" 'SpineJoin 22 7))))
                                                                    (leaf (token "*v" 'SpineJoin 23 6))))
                                                      (leaf (token "*v" 'SpineJoin 24 5))))
                                        (leaf (token "*" 'NullInterpretation 25 4))
                                        (leaf (token "*" 'NullInterpretation 26 3))
                                        (leaf (token "*" 'NullInterpretation 27 2))
                                        (leaf (token "==" 'Measure 28 1))
                                        (leaf (token "*-" 'SpineTerminator 29 1)))))))
|#
(check-expect (gspines->linked-spines (spine-parser (path->hfile "../../data/count/two-spines-three-splits.krn"))
                                      (path->hfile "../../data/count/two-spines-three-splits.krn"))
              (list (linked-spine KERN-0-0) (linked-spine KERN-0-1)))

(test)
